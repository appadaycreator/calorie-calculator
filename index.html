<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🍎 カロリー計算機 - スタイリッシュ版</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    <style>
        * {
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .input-field {
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .btn-gradient {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            transition: all 0.3s ease;
        }
        
        .btn-gradient:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        }
        
        .result-card {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            transition: all 0.3s ease;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            stroke-dasharray: 251.2;
            stroke-dashoffset: 251.2;
            transition: stroke-dashoffset 1s ease-in-out;
        }
        
        .floating-icon {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="gradient-bg">
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div class="container mx-auto px-4 py-8">
        <!-- ヘッダー -->
        <div class="text-center mb-12 animate-fade-in">
            <div class="floating-icon inline-block text-6xl mb-4">🍎</div>
            <h1 class="text-5xl font-bold text-white mb-4">カロリー計算機</h1>
            <p class="text-xl text-gray-200">目標体重まであと何kcal？理想の体型を手に入れよう！</p>
        </div>

        <!-- メイン計算フォーム -->
        <div class="max-w-4xl mx-auto mb-12">
            <div class="glass-card rounded-3xl p-8 animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- 身長 -->
                    <div class="space-y-2">
                        <label class="block text-white font-semibold text-lg">
                            <i class="fas fa-ruler-vertical mr-2 text-yellow-300"></i>身長 (cm)
                        </label>
                        <input type="number" id="height" class="input-field w-full px-4 py-3 rounded-xl border-0 focus:outline-none focus:ring-2 focus:ring-purple-400 text-lg" placeholder="170">
                    </div>

                    <!-- 体重 -->
                    <div class="space-y-2">
                        <label class="block text-white font-semibold text-lg">
                            <i class="fas fa-weight mr-2 text-blue-300"></i>現在の体重 (kg)
                        </label>
                        <input type="number" id="weight" class="input-field w-full px-4 py-3 rounded-xl border-0 focus:outline-none focus:ring-2 focus:ring-purple-400 text-lg" placeholder="70">
                    </div>

                    <!-- 年齢 -->
                    <div class="space-y-2">
                        <label class="block text-white font-semibold text-lg">
                            <i class="fas fa-birthday-cake mr-2 text-pink-300"></i>年齢
                        </label>
                        <input type="number" id="age" class="input-field w-full px-4 py-3 rounded-xl border-0 focus:outline-none focus:ring-2 focus:ring-purple-400 text-lg" placeholder="30">
                    </div>

                    <!-- 性別 -->
                    <div class="space-y-2">
                        <label class="block text-white font-semibold text-lg">
                            <i class="fas fa-venus-mars mr-2 text-green-300"></i>性別
                        </label>
                        <select id="gender" class="input-field w-full px-4 py-3 rounded-xl border-0 focus:outline-none focus:ring-2 focus:ring-purple-400 text-lg">
                            <option value="">選択してください</option>
                            <option value="male">男性</option>
                            <option value="female">女性</option>
                        </select>
                    </div>

                    <!-- 活動レベル -->
                    <div class="space-y-2">
                        <label class="block text-white font-semibold text-lg">
                            <i class="fas fa-running mr-2 text-orange-300"></i>活動レベル
                        </label>
                        <select id="activity" class="input-field w-full px-4 py-3 rounded-xl border-0 focus:outline-none focus:ring-2 focus:ring-purple-400 text-lg">
                            <option value="">選択してください</option>
                            <option value="1.2">座りがち（ほとんど運動しない）</option>
                            <option value="1.375">軽い運動（週1-3回）</option>
                            <option value="1.55">普通の運動（週3-5回）</option>
                            <option value="1.725">激しい運動（週6-7回）</option>
                            <option value="1.9">非常に激しい運動（1日2回など）</option>
                        </select>
                    </div>

                    <!-- 目標体重 -->
                    <div class="space-y-2">
                        <label class="block text-white font-semibold text-lg">
                            <i class="fas fa-bullseye mr-2 text-red-300"></i>目標体重 (kg)
                        </label>
                        <input type="number" id="targetWeight" class="input-field w-full px-4 py-3 rounded-xl border-0 focus:outline-none focus:ring-2 focus:ring-purple-400 text-lg" placeholder="65">
                    </div>
                </div>

                <div class="text-center">
                    <button onclick="calculateCalories()" class="btn-gradient text-white px-12 py-4 rounded-full font-bold text-xl shadow-lg">
                        <i class="fas fa-calculator mr-2"></i>計算する
                    </button>
                </div>
            </div>
        </div>

        <!-- 結果表示エリア -->
        <div id="results" class="max-w-6xl mx-auto mb-12 hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- BMR -->
                <div class="result-card rounded-2xl p-6 text-center">
                    <div class="text-4xl mb-3">⚡</div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">基礎代謝率 (BMR)</h3>
                    <div id="bmrResult" class="text-3xl font-bold text-purple-600">-</div>
                    <p class="text-gray-500 mt-2">kcal/日</p>
                </div>

                <!-- TDEE -->
                <div class="result-card rounded-2xl p-6 text-center">
                    <div class="text-4xl mb-3">🔥</div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">1日の消費カロリー</h3>
                    <div id="tdeeResult" class="text-3xl font-bold text-orange-600">-</div>
                    <p class="text-gray-500 mt-2">kcal/日</p>
                </div>

                <!-- 推奨摂取カロリー -->
                <div class="result-card rounded-2xl p-6 text-center">
                    <div class="text-4xl mb-3">🍽️</div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">推奨摂取カロリー</h3>
                    <div id="recommendedCalories" class="text-3xl font-bold text-green-600">-</div>
                    <p class="text-gray-500 mt-2">kcal/日</p>
                </div>

                <!-- 週間変化 -->
                <div class="result-card rounded-2xl p-6 text-center">
                    <div class="text-4xl mb-3">📊</div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">週間の体重変化予想</h3>
                    <div id="weeklyChange" class="text-3xl font-bold text-blue-600">-</div>
                    <p class="text-gray-500 mt-2">kg/週</p>
                </div>

                <!-- 目標達成日数 -->
                <div class="result-card rounded-2xl p-6 text-center">
                    <div class="text-4xl mb-3">🎯</div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">目標達成予想</h3>
                    <div id="targetDays" class="text-3xl font-bold text-pink-600">-</div>
                    <p class="text-gray-500 mt-2">日後</p>
                </div>

                <!-- プログレスリング -->
                <div class="result-card rounded-2xl p-6 text-center">
                    <div class="text-4xl mb-3">💪</div>
                    <h3 class="text-xl font-bold text-gray-700 mb-2">進捗</h3>
                    <div class="relative inline-block">
                        <svg class="progress-ring w-24 h-24" viewBox="0 0 84 84">
                            <circle class="progress-ring-circle" stroke="#e5e7eb" stroke-width="6" fill="transparent" r="40" cx="42" cy="42"/>
                            <circle id="progressCircle" class="progress-ring-circle" stroke="#10b981" stroke-width="6" fill="transparent" r="40" cx="42" cy="42"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="progressText" class="text-lg font-bold text-gray-700">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- チャート表示 -->
            <div class="glass-card rounded-3xl p-8">
                <h3 class="text-2xl font-bold text-white mb-6 text-center">
                    <i class="fas fa-chart-line mr-2"></i>カロリーバランス可視化
                </h3>
                <div class="bg-white rounded-2xl p-6">
                    <canvas id="calorieChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- ダイエットサポート -->
        <div class="max-w-4xl mx-auto mb-12">
            <div class="glass-card rounded-3xl p-8 animate-fade-in">
                <div class="text-center mb-8">
                    <div class="text-4xl mb-4">🏃‍♀️</div>
                    <h2 class="text-3xl font-bold text-white mb-4">ダイエット成功をサポート</h2>
                    <p class="text-gray-200 text-lg">おすすめダイエットプロテイン</p>
                </div>

                <div class="bg-white rounded-2xl p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">🥤 おすすめダイエットプロテイン</h3>
                        <span class="bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold">人気No.1</span>
                    </div>
                    <p class="text-gray-600 mb-4">カロリー制限中でも必要な栄養素をしっかり補給</p>
                    
                    <div class="bg-orange-50 rounded-xl p-4 mb-4">
                        <h4 class="font-bold text-orange-800 mb-2">このプロテインの特徴</h4>
                        <ul class="space-y-1 text-orange-700">
                            <li>• 低カロリー設計でダイエット中に最適</li>
                            <li>• 女性に嬉しいソイプロテイン配合</li>
                            <li>• 置き換えダイエットに効果的</li>
                            <li>• 送料無料でお得にお試し可能</li>
                        </ul>
                    </div>

                    <div class="text-center">
                        <a href="#" class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-full font-bold inline-flex items-center transition-all duration-300 transform hover:scale-105">
                            <i class="fas fa-shopping-cart mr-2"></i>楽天で購入
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 計算履歴 -->
        <div class="max-w-4xl mx-auto">
            <div class="glass-card rounded-3xl p-8 animate-fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        <i class="fas fa-history mr-3 text-yellow-300"></i>計算履歴
                    </h2>
                    <button onclick="clearHistory()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-full font-semibold transition-all duration-300">
                        <i class="fas fa-trash mr-2"></i>履歴クリア
                    </button>
                </div>
                <p class="text-gray-200 mb-4">計算結果がここに保存されます</p>
                <div id="history" class="space-y-3">
                    <!-- 履歴がここに表示されます -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let chart = null;

        function calculateCalories() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const age = parseFloat(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const activity = parseFloat(document.getElementById('activity').value);
            const targetWeight = parseFloat(document.getElementById('targetWeight').value);

            if (!height || !weight || !age || !gender || !activity || !targetWeight) {
                alert('すべての項目を入力してください');
                return;
            }

            // BMR計算（Harris-Benedict式）
            let bmr;
            if (gender === 'male') {
                bmr = 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
            } else {
                bmr = 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);
            }

            // TDEE計算
            const tdee = bmr * activity;

            // 目標体重までの変化量
            const weightDifference = weight - targetWeight;
            
            // 推奨摂取カロリー（1週間で0.5kg減量を想定）
            const recommendedCalories = tdee - 500; // 1日500kcal減で週約0.5kg減

            // 週間の体重変化予想
            const weeklyChange = 0.5; // kg/週

            // 目標達成予想日数
            const targetDays = Math.abs(weightDifference / weeklyChange * 7);

            // 結果を表示
            document.getElementById('bmrResult').textContent = Math.round(bmr);
            document.getElementById('tdeeResult').textContent = Math.round(tdee);
            document.getElementById('recommendedCalories').textContent = Math.round(recommendedCalories);
            document.getElementById('weeklyChange').textContent = weightDifference > 0 ? `-${weeklyChange}` : `+${weeklyChange}`;
            document.getElementById('targetDays').textContent = Math.round(targetDays);

            // プログレス表示
            updateProgress(weight, targetWeight);

            // 結果エリアを表示
            const resultsDiv = document.getElementById('results');
            resultsDiv.classList.remove('hidden');
            resultsDiv.classList.add('animate-fade-in');

            // チャート作成
            createChart(bmr, tdee, recommendedCalories);

            // 履歴に保存
            saveToHistory({
                date: new Date().toLocaleString('ja-JP'),
                height, weight, targetWeight, bmr: Math.round(bmr), 
                tdee: Math.round(tdee), recommended: Math.round(recommendedCalories)
            });

            // 結果エリアまでスクロール
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function updateProgress(current, target) {
            // 進捗を計算（仮に20%として設定）
            const progress = 20;
            const circle = document.getElementById('progressCircle');
            const progressText = document.getElementById('progressText');
            
            const circumference = 2 * Math.PI * 40;
            const offset = circumference - (progress / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            progressText.textContent = `${progress}%`;
        }

        function createChart(bmr, tdee, recommended) {
            const ctx = document.getElementById('calorieChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['基礎代謝', '活動代謝', '推奨摂取'],
                    datasets: [{
                        data: [bmr, tdee - bmr, recommended],
                        backgroundColor: [
                            '#8b5cf6',
                            '#f59e0b', 
                            '#10b981'
                        ],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }

        function saveToHistory(data) {
            let history = JSON.parse(localStorage.getItem('calorieHistory')) || [];
            history.unshift(data);
            history = history.slice(0, 10); // 最新10件まで保存
            localStorage.setItem('calorieHistory', JSON.stringify(history));
            displayHistory();
        }

        function displayHistory() {
            const history = JSON.parse(localStorage.getItem('calorieHistory')) || [];
            const historyDiv = document.getElementById('history');
            
            if (history.length === 0) {
                historyDiv.innerHTML = '<p class="text-gray-300 italic">まだ計算履歴がありません</p>';
                return;
            }
            
            historyDiv.innerHTML = history.map(item => `
                <div class="bg-white bg-opacity-20 rounded-xl p-4 text-white">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold">${item.date}</span>
                        <span class="text-sm opacity-75">${item.height}cm / ${item.weight}kg → ${item.targetWeight}kg</span>
                    </div>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div>BMR: ${item.bmr}kcal</div>
                        <div>TDEE: ${item.tdee}kcal</div>
                        <div>推奨: ${item.recommended}kcal</div>
                    </div>
                </div>
            `).join('');
        }

        function clearHistory() {
            if (confirm('計算履歴をすべて削除しますか？')) {
                localStorage.removeItem('calorieHistory');
                displayHistory();
            }
        }

        // ページ読み込み時に履歴を表示
        document.addEventListener('DOMContentLoaded', function() {
            displayHistory();
        });
    </script>
</body>
</html>