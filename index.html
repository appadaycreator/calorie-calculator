<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—æ©Ÿ - ç†æƒ³ã®ä½“å‹ã¸ã®ã‚¹ãƒãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰</title>
    <meta name="description" content="ç§‘å­¦çš„æ ¹æ‹ ã«åŸºã¥ã„ãŸã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—ã§ç†æƒ³ã®ä½“å‹ã‚’å®Ÿç¾ã€‚åŸºç¤ä»£è¬ãƒ»æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ãƒ»ç›®æ¨™é”æˆæ—¥æ•°ã‚’æ­£ç¢ºã«ç®—å‡ºã—ã¾ã™ã€‚">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ</text></svg>">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0"></script>
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .emoji-icon {
            font-size: 4rem;
            display: block;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* Calculator Card */
        .calculator-card {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .calculator-title {
            font-size: 2rem;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        /* Form Styling */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .form-input, .form-select {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .form-input::placeholder {
            color: #a0aec0;
        }

        /* Button */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
            min-width: 200px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        /* Results Section */
        .results {
            display: none;
            margin-top: 40px;
        }

        .results.show {
            display: block;
            animation: fadeInUp 0.6s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        .result-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .result-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .result-unit {
            font-size: 1rem;
            color: #718096;
        }

        .result-description {
            font-size: 0.9rem;
            color: #a0aec0;
            margin-top: 10px;
        }

        /* Colors for different metrics */
        .bmr .result-value { color: #8b5cf6; }
        .tdee .result-value { color: #f59e0b; }
        .recommended .result-value { color: #10b981; }
        .weekly .result-value { color: #3b82f6; }
        .target .result-value { color: #ec4899; }

        /* Chart Section */
        .chart-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-bottom: 25px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        /* Affiliate Section */
        .affiliate-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
        }

        .affiliate-title {
            font-size: 2rem;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-bottom: 25px;
        }

        .affiliate-subtitle {
            font-size: 1.1rem;
            color: #666;
            text-align: center;
            margin-bottom: 30px;
        }

        .product-highlight {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .product-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            font-weight: 500;
            color: #2d3748;
        }

        .feature-icon {
            color: #10b981;
            margin-right: 10px;
            font-size: 1.1rem;
        }

        /* History Section */
        .history-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .history-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: white;
        }

        .btn-secondary {
            background: #ef4444;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .history-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #ffd700;
        }

        .history-date {
            font-weight: 600;
            color: white;
            margin-bottom: 10px;
        }

        .history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            color: #e2e8f0;
            font-size: 0.9rem;
        }

        /* Share Buttons */
        .share-section {
            text-align: center;
            margin: 30px 0;
        }

        .btn-share {
            background: #1da1f2;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .btn-share:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(29, 161, 242, 0.3);
        }

        .btn-download {
            background: #10b981;
        }

        .btn-download:hover {
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2.5rem;
            }

            .calculator-card {
                padding: 25px;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .result-card {
                padding: 20px;
            }

            .result-value {
                font-size: 2rem;
            }

            .affiliate-section,
            .history-section {
                padding: 25px;
            }

            .history-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .history-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: white;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus States */
        .form-input:focus,
        .form-select:focus,
        .btn-primary:focus,
        .btn-secondary:focus,
        .btn-share:focus {
            outline: 2px solid #4299e1;
            outline-offset: 2px;
        }

        /* æ¥½å¤©ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        .rakuten-affiliate {
            width: 100%;
            max-width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 20px 0;
            padding: 0;
        }

        .rakuten-affiliate iframe {
            max-width: 100%;
            height: auto;
            min-height: 300px;
        }

        /* ãƒ•ãƒƒã‚¿ãƒ¼ */
        .footer {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px 20px;
            margin-top: 60px;
            color: white;
            text-align: center;
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .copyright {
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .disclaimer {
            font-size: 0.8rem;
            opacity: 0.8;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .footer-links {
            margin-top: 20px;
        }

        .footer-links a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
            font-size: 0.9rem;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .footer-links a:hover {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }

            .calculator-card {
                padding: 20px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .rakuten-affiliate {
                margin: 15px 0;
            }

            .footer {
                padding: 30px 15px;
            }
        }
    </style>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <span class="emoji-icon">ğŸ</span>
            <h1>ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—æ©Ÿ</h1>
            <p>ç§‘å­¦çš„æ ¹æ‹ ã«åŸºã¥ã„ãŸHarris-Benedictå¼ã§ã€ã‚ãªãŸã®åŸºç¤ä»£è¬ã¨ç›®æ¨™é”æˆã¾ã§ã®æœ€é©ãªã‚«ãƒ­ãƒªãƒ¼ãƒ—ãƒ©ãƒ³ã‚’ç®—å‡ºã—ã¾ã™</p>
        </header>

        <!-- Calculator -->
        <main class="calculator-card">
            <h2 class="calculator-title">åŸºæœ¬æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
            
            <form id="calorieForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="height" class="form-label">ğŸ“ èº«é•· (cm)</label>
                        <input type="number" id="height" class="form-input" placeholder="170" min="100" max="250" step="0.1" required>
                        <small style="color: #718096; margin-top: 5px;">100ã€œ250cmã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                    </div>

                    <div class="form-group">
                        <label for="weight" class="form-label">âš–ï¸ ç¾åœ¨ã®ä½“é‡ (kg)</label>
                        <input type="number" id="weight" class="form-input" placeholder="70" min="20" max="300" step="0.1" required>
                        <small style="color: #718096; margin-top: 5px;">20ã€œ300kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                    </div>

                    <div class="form-group">
                        <label for="age" class="form-label">ğŸ‚ å¹´é½¢</label>
                        <input type="number" id="age" class="form-input" placeholder="30" min="10" max="120" required>
                        <small style="color: #718096; margin-top: 5px;">10ã€œ120æ­³ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                    </div>

                    <div class="form-group">
                        <label for="gender" class="form-label">ğŸ‘¤ æ€§åˆ¥</label>
                        <select id="gender" class="form-select" required>
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="male">ğŸ‘¨ ç”·æ€§</option>
                            <option value="female">ğŸ‘© å¥³æ€§</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="activity" class="form-label">ğŸƒ æ´»å‹•ãƒ¬ãƒ™ãƒ«</label>
                        <select id="activity" class="form-select" required>
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="1.2">ğŸª‘ åº§ã‚ŠãŒã¡ï¼ˆã»ã¨ã‚“ã©é‹å‹•ã—ãªã„ï¼‰</option>
                            <option value="1.375">ğŸš¶ è»½ã„é‹å‹•ï¼ˆé€±1-3å›ï¼‰</option>
                            <option value="1.55">ğŸƒ æ™®é€šã®é‹å‹•ï¼ˆé€±3-5å›ï¼‰</option>
                            <option value="1.725">ğŸ’ª æ¿€ã—ã„é‹å‹•ï¼ˆé€±6-7å›ï¼‰</option>
                            <option value="1.9">ğŸ”¥ éå¸¸ã«æ¿€ã—ã„é‹å‹•ï¼ˆ1æ—¥2å›ãªã©ï¼‰</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="targetWeight" class="form-label">ğŸ¯ ç›®æ¨™ä½“é‡ (kg)</label>
                        <input type="number" id="targetWeight" class="form-input" placeholder="65" min="20" max="300" step="0.1" required>
                        <small style="color: #718096; margin-top: 5px;">20ã€œ300kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                    </div>
                </div>

                <button type="submit" class="btn-primary">
                    ğŸ§® è¨ˆç®—ã™ã‚‹
                </button>
            </form>

            <!-- Loading -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>æœ€é©ãªãƒ—ãƒ©ãƒ³ã‚’ä½œæˆä¸­...</p>
            </div>
        </main>

        <!-- Results -->
        <section id="results" class="results">
            <div class="calculator-card">
                <h2 class="calculator-title">ğŸ¯ ã‚ãªãŸã®è¨ˆç®—çµæœ</h2>
                
                <div class="results-grid">
                    <div class="result-card bmr">
                        <span class="result-icon">âš¡</span>
                        <div class="result-title">åŸºç¤ä»£è¬ç‡</div>
                        <div class="result-value" id="bmrResult">-</div>
                        <div class="result-unit">kcal/æ—¥</div>
                        <div class="result-description">ç”Ÿå‘½ç¶­æŒã«å¿…è¦ãªæœ€ä½ã‚«ãƒ­ãƒªãƒ¼</div>
                    </div>

                    <div class="result-card tdee">
                        <span class="result-icon">ğŸ”¥</span>
                        <div class="result-title">1æ—¥ã®æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼</div>
                        <div class="result-value" id="tdeeResult">-</div>
                        <div class="result-unit">kcal/æ—¥</div>
                        <div class="result-description">æ´»å‹•ã‚’å«ã‚€ç·æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼</div>
                    </div>

                    <div class="result-card recommended">
                        <span class="result-icon">ğŸ½ï¸</span>
                        <div class="result-title">æ¨å¥¨æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼</div>
                        <div class="result-value" id="recommendedResult">-</div>
                        <div class="result-unit">kcal/æ—¥</div>
                        <div class="result-description">ç›®æ¨™é”æˆã®ãŸã‚ã®æ‘‚å–é‡</div>
                    </div>

                    <div class="result-card weekly">
                        <span class="result-icon">ğŸ“Š</span>
                        <div class="result-title">é€±é–“ã®ä½“é‡å¤‰åŒ–</div>
                        <div class="result-value" id="weeklyResult">-</div>
                        <div class="result-unit">kg/é€±</div>
                        <div class="result-description">å¥åº·çš„ãªãƒšãƒ¼ã‚¹ã§ã®å¤‰åŒ–</div>
                    </div>

                    <div class="result-card target">
                        <span class="result-icon">ğŸ¯</span>
                        <div class="result-title">ç›®æ¨™é”æˆäºˆæƒ³</div>
                        <div class="result-value" id="targetResult">-</div>
                        <div class="result-unit">æ—¥å¾Œ</div>
                        <div class="result-description">ç¶™ç¶šã™ã‚Œã°é”æˆå¯èƒ½</div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="chart-section">
                    <h3 class="chart-title">ğŸ“Š ã‚«ãƒ­ãƒªãƒ¼ãƒãƒ©ãƒ³ã‚¹è©³ç´°åˆ†æ</h3>
                    <div class="chart-container">
                        <canvas id="calorieChart"></canvas>
                    </div>
                </div>

                <!-- Share Buttons -->
                <div class="share-section">
                    <button onclick="shareResults()" class="btn-share">
                        ğŸ“± çµæœã‚’ã‚·ã‚§ã‚¢
                    </button>
                    <button onclick="downloadResults()" class="btn-share btn-download">
                        ğŸ“„ çµæœã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                </div>
            </div>
        </section>

        <!-- Affiliate Section -->
        <section class="affiliate-section">
            <h2 class="affiliate-title">ğŸƒâ€â™€ï¸ ãƒ€ã‚¤ã‚¨ãƒƒãƒˆæˆåŠŸã‚’ã‚µãƒãƒ¼ãƒˆ</h2>
            <p class="affiliate-subtitle">ã‚ãªãŸã®ç›®æ¨™é”æˆã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹å³é¸å•†å“</p>
            
            <div class="product-highlight">
                <h3 style="font-size: 1.3rem; font-weight: 600; margin-bottom: 15px; color: #2d3748;">
                    ğŸ¥¤ ãŠã™ã™ã‚ãƒ€ã‚¤ã‚¨ãƒƒãƒˆãƒ—ãƒ­ãƒ†ã‚¤ãƒ³
                </h3>
                
                <div class="product-features">
                    <div class="feature-item">
                        <span class="feature-icon">âœ…</span>
                        ä½ã‚«ãƒ­ãƒªãƒ¼è¨­è¨ˆã§ãƒ€ã‚¤ã‚¨ãƒƒãƒˆä¸­ã«æœ€é©
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">âœ…</span>
                        å¥³æ€§ã«å¬‰ã—ã„ã‚½ã‚¤ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³é…åˆ
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">âœ…</span>
                        ç½®ãæ›ãˆãƒ€ã‚¤ã‚¨ãƒƒãƒˆã«åŠ¹æœçš„
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">âœ…</span>
                        é€æ–™ç„¡æ–™ã§ãŠå¾—ã«ãŠè©¦ã—å¯èƒ½
                    </div>
                </div>
            </div>

            <div style="text-align: center; background: #f7fafc; padding: 20px; border-radius: 15px;">
                <table border="0" cellpadding="0" cellspacing="0" style="margin: 0 auto;"><tr><td><div style="border:1px solid #95a5a6;border-radius:.75rem;background-color:#FFFFFF;width:504px;margin:0px;padding:5px;text-align:center;overflow:hidden;"><table><tr><td style="width:240px"><a href="https://hb.afl.rakuten.co.jp/ichiba/48d485d8.5fb22ab4.48d485d9.de59eec5/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbambi-water%2Fbambidietshake%2F&link_type=picttext&ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJwaWN0dGV4dCIsInNpemUiOiIyNDB4MjQwIiwibmFtIjoxLCJuYW1wIjoicmlnaHQiLCJjb20iOjEsImNvbXAiOiJkb3duIiwicHJpY2UiOjEsImJvciI6MSwiY29sIjoxLCJiYnRuIjoxLCJwcm9kIjowLCJhbXAiOmZhbHNlfQ%3D%3D" target="_blank" rel="nofollow sponsored noopener" style="word-wrap:break-word;"><img src="https://hbb.afl.rakuten.co.jp/hgb/48d485d8.5fb22ab4.48d485d9.de59eec5/?me_id=1294199&item_id=10000052&pc=https%3A%2F%2Fthumbnail.image.rakuten.co.jp%2F%400_mall%2Fbambi-water%2Fcabinet%2Fpage%2Fbps%2Fbps_th00_2412.jpg%3F_ex%3D240x240&s=240x240&t=picttext" border="0" style="margin:2px" alt="ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ãƒ€ã‚¤ã‚¨ãƒƒãƒˆå•†å“" title="ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ãƒ€ã‚¤ã‚¨ãƒƒãƒˆå•†å“"></a></td><td style="vertical-align:top;width:248px;display: block;"><p style="font-size:12px;line-height:1.4em;text-align:left;margin:0px;padding:2px 6px;word-wrap:break-word"><a href="https://hb.afl.rakuten.co.jp/ichiba/48d485d8.5fb22ab4.48d485d9.de59eec5/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbambi-water%2Fbambidietshake%2F&link_type=picttext&ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJwaWN0dGV4dCIsInNpemUiOiIyNDB4MjQwIiwibmFtIjoxLCJuYW1wIjoicmlnaHQiLCJjb20iOjEsImNvbXAiOiJkb3duIiwicHJpY2UiOjEsImJvciI6MSwiY29sIjoxLCJiYnRuIjoxLCJwcm9kIjowLCJhbXAiOmZhbHNlfQ%3D%3D" target="_blank" rel="nofollow sponsored noopener" style="word-wrap:break-word;">æœ¬æ—¥çµ‚äº†ï¼¼P5å€ï¼ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ å¥³æ€§ ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ ã‚½ã‚¤ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ ç½®ãæ›ãˆãƒ€ã‚¤ã‚¨ãƒƒãƒˆ ç½®ãæ›ãˆ ã‚·ã‚§ã‚¤ã‚¯ ãƒ•ã‚¡ã‚¹ãƒ†ã‚£ãƒ³ã‚° ã‚¿ãƒ³ãƒ‘ã‚¯è³ª ä½ç³–è³ª ä½è„‚è³ª ãƒ›ã‚¨ã‚¤ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ ä½ã‚«ãƒ­ãƒªãƒ¼ ãƒãƒ³ãƒ“ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ æ˜¥å¤</a><br><span style="color: #e53e3e; font-weight: bold; font-size: 14px;">ä¾¡æ ¼ï¼š2,998å††ï¼ˆç¨è¾¼ã€é€æ–™ç„¡æ–™)</span> <span style="color:#BBB">(2025/6/4æ™‚ç‚¹)</span></p><div style="margin:10px;"><a href="https://hb.afl.rakuten.co.jp/ichiba/48d485d8.5fb22ab4.48d485d9.de59eec5/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbambi-water%2Fbambidietshake%2F&link_type=picttext&ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJwaWN0dGV4dCIsInNpemUiOiIyNDB4MjQwIiwibmFtIjoxLCJuYW1wIjoicmlnaHQiLCJjb20iOjEsImNvbXAiOiJkb3duIiwicHJpY2UiOjEsImJvciI6MSwiY29sIjoxLCJiYnRuIjoxLCJwcm9kIjowLCJhbXAiOmZhbHNlfQ%3D%3D" target="_blank" rel="nofollow sponsored noopener" style="word-wrap:break-word;"><img src="https://static.affiliate.rakuten.co.jp/makelink/rl.svg" style="float:left;max-height:27px;width:auto;margin-top:0" ></a><a href="https://hb.afl.rakuten.co.jp/ichiba/48d485d8.5fb22ab4.48d485d9.de59eec5/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbambi-water%2Fbambidietshake%2F%3Fscid%3Daf_pc_bbtn&link_type=picttext&ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJwaWN0dGV4dCIsInNpemUiOiIyNDB4MjQwIiwibmFtIjoxLCJuYW1wIjoicmlnaHQiLCJjb20iOjEsImNvbXAiOiJkb3duIiwicHJpY2UiOjEsImJvciI6MSwiY29sIjoxLCJiYnRuIjoxLCJwcm9kIjowLCJhbXAiOmZhbHNlfQ==" target="_blank" rel="nofollow sponsored noopener" style="word-wrap:break-word;"><div style="float:right;width:41%;height:27px;background-color:#bf0000;color:#fff!important;font-size:12px;font-weight:500;line-height:27px;margin-left:1px;padding: 0 12px;border-radius:16px;cursor:pointer;text-align:center;"> æ¥½å¤©ã§è³¼å…¥ </div></a></div></td></tr></table></div><br><p style="color:#000000;font-size:12px;line-height:1.4em;margin:5px;word-wrap:break-word"></p></td></tr></table>
            </div>
        </section>

        <!-- History -->
        <section class="history-section">
            <div class="history-header">
                <h2 class="history-title">ğŸ“Š è¨ˆç®—å±¥æ­´</h2>
                <button onclick="clearHistory()" class="btn-secondary">
                    ğŸ—‘ï¸ å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
                </button>
            </div>
            <div id="historyContainer">
                <p style="color: #e2e8f0; text-align: center; font-style: italic;">
                    ã¾ã è¨ˆç®—å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“
                </p>
            </div>
        </section>
    </div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="footer">
        <div class="footer-content">
            <div class="copyright">
                Â© 2024 ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—æ©Ÿ All Rights Reserved.
            </div>
            <div class="disclaimer">
                å…è²¬äº‹é …ï¼šã“ã®ã‚µã‚¤ãƒˆã§æä¾›ã•ã‚Œã‚‹æƒ…å ±ã¯ã€ä¸€èˆ¬çš„ãªå¥åº·ç®¡ç†ã®å‚è€ƒæƒ…å ±ã¨ã—ã¦æä¾›ã•ã‚Œã‚‹ã‚‚ã®ã§ã™ã€‚
                åŒ»ç™‚çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚„è¨ºæ–­ã‚’ç›®çš„ã¨ã—ãŸã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å¥åº·ã«é–¢ã™ã‚‹å…·ä½“çš„ãªå•é¡Œã‚„æ‡¸å¿µãŒã‚ã‚‹å ´åˆã¯ã€
                å¿…ãšåŒ»å¸«ã‚„å°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚ã¾ãŸã€ã“ã®ã‚µã‚¤ãƒˆã®åˆ©ç”¨ã«ã‚ˆã£ã¦ç”Ÿã˜ãŸã„ã‹ãªã‚‹æå®³ã«ã¤ã„ã¦ã‚‚ã€
                å½“ã‚µã‚¤ãƒˆã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
            </div>
            <div class="footer-links">
                <a href="privacy-policy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
                <a href="terms.html">åˆ©ç”¨è¦ç´„</a>
                <a href="contact.html">ãŠå•ã„åˆã‚ã›</a>
            </div>
        </div>
    </footer>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let chart = null;
        let currentResults = null;

        // localStorage ã®å®‰å…¨ãªæ“ä½œ
        const SafeStorage = {
            get: (key) => {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    console.warn('localStorage read failed:', e);
                    return null;
                }
            },
            set: (key, value) => {
                try {
                    localStorage.setItem(key, value);
                    return true;
                } catch (e) {
                    console.warn('localStorage write failed:', e);
                    return false;
                }
            },
            remove: (key) => {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (e) {
                    console.warn('localStorage remove failed:', e);
                    return false;
                }
            }
        };

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function formatNumber(num) {
            return Math.round(num).toLocaleString();
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast show';
            toast.style.backgroundColor = type === 'success' ? '#10b981' : '#ef4444';
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // è¨ˆç®—é–¢æ•°
        function calculateBMR(weight, height, age, gender) {
            if (gender === 'male') {
                return 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
            } else {
                return 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);
            }
        }

        function calculateTDEE(bmr, activityLevel) {
            return bmr * parseFloat(activityLevel);
        }

        function calculateCalorieAdjustment(currentWeight, targetWeight, tdee) {
            const weightDifference = currentWeight - targetWeight;
            const caloriesPerKg = 7700;
            
            if (Math.abs(weightDifference) < 0.1) {
                return {
                    recommendedCalories: Math.round(tdee),
                    weeklyChange: 0,
                    estimatedDays: 0
                };
            }
            
            if (weightDifference > 0) {
                // æ¸›é‡
                const safeWeeklyLoss = Math.min(0.7, weightDifference / 10);
                const dailyDeficit = (safeWeeklyLoss * caloriesPerKg) / 7;
                
                return {
                    recommendedCalories: Math.round(tdee - dailyDeficit),
                    weeklyChange: -safeWeeklyLoss,
                    estimatedDays: Math.round((weightDifference / safeWeeklyLoss) * 7)
                };
            } else {
                // å¢—é‡
                const safeWeeklyGain = Math.min(0.5, Math.abs(weightDifference) / 10);
                const dailySurplus = (safeWeeklyGain * caloriesPerKg) / 7;
                
                return {
                    recommendedCalories: Math.round(tdee + dailySurplus),
                    weeklyChange: safeWeeklyGain,
                    estimatedDays: Math.round((Math.abs(weightDifference) / safeWeeklyGain) * 7)
                };
            }
        }

        // ãƒ¡ã‚¤ãƒ³è¨ˆç®—å‡¦ç†
        function calculateCalories() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const age = parseInt(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const activity = document.getElementById('activity').value;
            const targetWeight = parseFloat(document.getElementById('targetWeight').value);

            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!height || !weight || !age || !gender || !activity || !targetWeight) {
                showToast('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            if (height < 100 || height > 250 || weight < 20 || weight > 300 || 
                age < 10 || age > 120 || targetWeight < 20 || targetWeight > 300) {
                showToast('å…¥åŠ›å€¤ãŒç¯„å›²å¤–ã§ã™', 'error');
                return;
            }

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            document.getElementById('loading').classList.add('show');
            
            // è¨ˆç®—å®Ÿè¡Œï¼ˆé…å»¶ã‚’è¿½åŠ ã—ã¦ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°åŠ¹æœã‚’æ¼”å‡ºï¼‰
            setTimeout(() => {
                try {
                    const bmr = calculateBMR(weight, height, age, gender);
                    const tdee = calculateTDEE(bmr, activity);
                    const adjustment = calculateCalorieAdjustment(weight, targetWeight, tdee);

                    currentResults = {
                        height, weight, targetWeight, bmr, tdee, ...adjustment
                    };

                    displayResults(currentResults);
                    saveToHistory(currentResults);
                    
                    document.getElementById('loading').classList.remove('show');
                    document.getElementById('results').classList.add('show');
                    
                    // çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                    
                    showToast('è¨ˆç®—ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                } catch (error) {
                    document.getElementById('loading').classList.remove('show');
                    showToast('è¨ˆç®—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
                    console.error('Calculation error:', error);
                }
            }, 1500);
        }

        // çµæœè¡¨ç¤º
        function displayResults(data) {
            document.getElementById('bmrResult').textContent = formatNumber(data.bmr);
            document.getElementById('tdeeResult').textContent = formatNumber(data.tdee);
            document.getElementById('recommendedResult').textContent = formatNumber(data.recommendedCalories);
            document.getElementById('weeklyResult').textContent = `${data.weeklyChange > 0 ? '+' : ''}${data.weeklyChange.toFixed(1)}`;
            document.getElementById('targetResult').textContent = data.estimatedDays === 0 ? 'é”æˆæ¸ˆã¿' : formatNumber(data.estimatedDays);

            createChart(data);
        }

        // ãƒãƒ£ãƒ¼ãƒˆä½œæˆ
        function createChart(data) {
            const ctx = document.getElementById('calorieChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['åŸºç¤ä»£è¬', 'æ´»å‹•ä»£è¬', 'æ¨å¥¨æ‘‚å–'],
                    datasets: [{
                        data: [data.bmr, data.tdee - data.bmr, data.recommendedCalories],
                        backgroundColor: ['#8b5cf6', '#f59e0b', '#10b981'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 14, weight: '500' }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    return `${context.label}: ${formatNumber(context.parsed)} kcal`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // å±¥æ­´ç®¡ç†
        function saveToHistory(data) {
            const historyData = SafeStorage.get('calorieHistory');
            let history = historyData ? JSON.parse(historyData) : [];
            
            const historyItem = {
                date: new Date().toLocaleString('ja-JP'),
                ...data
            };
            
            history.unshift(historyItem);
            history = history.slice(0, 10); // æœ€æ–°10ä»¶ã¾ã§ä¿å­˜
            
            SafeStorage.set('calorieHistory', JSON.stringify(history));
            displayHistory();
        }

        function displayHistory() {
            const historyData = SafeStorage.get('calorieHistory');
            const history = historyData ? JSON.parse(historyData) : [];
            const container = document.getElementById('historyContainer');
            
            if (history.length === 0) {
                container.innerHTML = '<p style="color: #e2e8f0; text-align: center; font-style: italic;">ã¾ã è¨ˆç®—å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            
            container.innerHTML = history.map(item => `
                <div class="history-item">
                    <div class="history-date">${item.date}</div>
                    <div class="history-details">
                        <div>èº«é•·: ${item.height}cm</div>
                        <div>ä½“é‡: ${item.weight}kg</div>
                        <div>ç›®æ¨™: ${item.targetWeight}kg</div>
                        <div>BMR: ${formatNumber(item.bmr)}kcal</div>
                        <div>TDEE: ${formatNumber(item.tdee)}kcal</div>
                        <div>æ¨å¥¨: ${formatNumber(item.recommendedCalories)}kcal</div>
                        <div>äºˆæƒ³: ${item.estimatedDays === 0 ? 'é”æˆæ¸ˆã¿' : item.estimatedDays + 'æ—¥'}</div>
                    </div>
                </div>
            `).join('');
        }

        function clearHistory() {
            if (confirm('ã™ã¹ã¦ã®è¨ˆç®—å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                SafeStorage.remove('calorieHistory');
                displayHistory();
                showToast('å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
            }
        }

        // ã‚·ã‚§ã‚¢ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
        function shareResults() {
            if (!currentResults) {
                showToast('ã¾ãšè¨ˆç®—ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const shareText = `ğŸ ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—çµæœ\n\n` +
                             `åŸºç¤ä»£è¬: ${formatNumber(currentResults.bmr)} kcal\n` +
                             `æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼: ${formatNumber(currentResults.tdee)} kcal\n` +
                             `æ¨å¥¨æ‘‚å–: ${formatNumber(currentResults.recommendedCalories)} kcal\n` +
                             `ç›®æ¨™é”æˆã¾ã§: ${currentResults.estimatedDays}æ—¥\n\n` +
                             `#ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®— #ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ #å¥åº·ç®¡ç† #ç¶™ç¶šã¯åŠ›ãªã‚Š\n` +
                             `${window.location.href}`;

            if (navigator.share) {
                navigator.share({
                    title: 'ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—çµæœ',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showToast('çµæœã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
                }).catch(() => {
                    showToast('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                });
            }
        }

        function downloadResults() {
            if (!currentResults) {
                showToast('ã¾ãšè¨ˆç®—ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const report = `ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—çµæœãƒ¬ãƒãƒ¼ãƒˆ\n` +
                          `ç”Ÿæˆæ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}\n\n` +
                          `åŸºæœ¬æƒ…å ±:\n` +
                          `èº«é•·: ${currentResults.height}cm\n` +
                          `ä½“é‡: ${currentResults.weight}kg\n` +
                          `ç›®æ¨™ä½“é‡: ${currentResults.targetWeight}kg\n\n` +
                          `è¨ˆç®—çµæœ:\n` +
                          `åŸºç¤ä»£è¬ç‡: ${formatNumber(currentResults.bmr)} kcal/æ—¥\n` +
                          `1æ—¥ã®æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼: ${formatNumber(currentResults.tdee)} kcal/æ—¥\n` +
                          `æ¨å¥¨æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼: ${formatNumber(currentResults.recommendedCalories)} kcal/æ—¥\n` +
                          `é€±é–“ã®ä½“é‡å¤‰åŒ–äºˆæƒ³: ${currentResults.weeklyChange.toFixed(1)} kg/é€±\n` +
                          `ç›®æ¨™é”æˆäºˆæƒ³æ—¥æ•°: ${currentResults.estimatedDays}æ—¥\n`;

            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—çµæœ_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼');
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener('DOMContentLoaded', function() {
            // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
            document.getElementById('calorieForm').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateCalories();
            });

            // å±¥æ­´è¡¨ç¤º
            displayHistory();

            // ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£: Enterã‚­ãƒ¼ã§ã®é€ä¿¡
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.target.tagName !== 'BUTTON') {
                    e.preventDefault();
                    calculateCalories();
                }
            });
        });
    </script>
</body>
</html>